<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>51 Pegasi B</title>
    <!-- Link Swiper's CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/all.min.css" />
    <link rel="stylesheet" href="../css/data.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet" />
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=ud7gtD6C"></script>
    <link rel="icon" href="../images/logo-4.png" type="image/png" />
</head>

<body>
    <main class="main">
        <button id="back-to-top"><i class="fa-solid fa-arrow-up"></i></button>
        <!-- Logo -->
        <div class="logo sticky-top">
            <div class="container">
                <img src="../images/logo-4.png" alt="" width="40" />
                <a href="../index.html">Vega</a>
            </div>
        </div>
        <div class="sticker-background">
            <!-- Sticker Images -->
            <img class="sticker sticker-1" src="../images/14.png" alt="Sticker 1">
            <img class="sticker sticker-2" src="../images/18.png" alt="Sticker 2">
            <img class="sticker sticker-3" src="../images/19.png" alt="Sticker 3">
            <img class="sticker sticker-4" src="../images/17.png" alt="Sticker 4">
            <img class="sticker sticker-5" src="../images/13.png" alt="Sticker 5">
            <img class="sticker sticker-6" src="../images/15.png" alt="Sticker 6">
            <img class="sticker sticker-7" src="../images/20.png" alt="Sticker 7">
            <img class="sticker sticker-8" src="../images/16.png" alt="Sticker 8">

            <!-- Content Layered on Top -->
            <div class="content">
                <div class="title text-center">
                    <h1 class="display-5 mb-2">Design Your Own Space Story!</h1>
                    <p>"Tell us about yourself, and we'll create a space adventure just for you!"</p>
                </div>
                <form onsubmit="event.preventDefault(); generateStory();">
                    <div class="form-row data-entry">
                        <div class="input-data">
                            <input type="text" id="name" required>
                            <label for="name">Explorer's Name:</label>
                        </div>
                        <div class="input-data">
                            <input type="text" id="age" required>
                            <label for="age">Explorerâ€™s Age:</label>
                        </div>
                        <div class="input-data">
                            <input type="text" id="interests" required>
                            <label for="interests">What interests you?</label>
                        </div>
                        <div class="input-data">
                            <input type="text" id="language" required>
                            <label for="language">Choose your story language.</label>
                        </div>
                    </div>
                    <div class="form-row submit-data">
                        <div class="input-data">
                            <button class="submit-btn" type="submit">Generate</button>
                        </div>
                    </div>
                </form>
                <div class="container" id="output" class="story-output"></div>
            </div>
        </div>
    </main>
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="../js/data.js"></script>
    <script src="../js/bootstrap.bundle.min.js"></script>
    <script src="../js/all.min.js"></script>
    <script>
        async function generateStory() {
            const name = document.getElementById('name').value;
            const age = document.getElementById('age').value;
            const interests = document.getElementById('interests').value;
            const lang = document.getElementById('language').value;
            const planet = "trappist-1e";

            try {
                const response = await fetch('https://story-creator-iy5s.vercel.app/story', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, lang, planet, interests: interests.split(','), school: age })
                });

                if (response.ok) {
                    const data = await response.json();
                    displayStory(data.data);
                } else {
                    alert('Failed to generate story. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while generating the story. Please check your internet connection and try again.');
            }
        }

        function displayStory(story) {
            const output = document.getElementById("output");
            output.innerHTML = ''; // Clear previous content
            story.forEach((part, index) => {
                const section = document.createElement("div");
                section.className = "section";
                section.innerHTML = `<h3>Part ${index + 1}</h3><p>${part}</p>`;
                output.appendChild(section);
            });

            manageScroll(); // Trigger scroll management
        }

        function manageScroll() {
            const sections = document.querySelectorAll(".section");
            let currentIndex = 0;

            const showSection = (index) => {
                if (index < sections.length) {
                    sections[index].style.display = "block"; // Show section
                    speakText(sections[index].textContent, () => {
                        if (currentIndex + 1 < sections.length) {
                            hideSection(index);
                            currentIndex++;
                            setTimeout(() => {
                                showSection(currentIndex);
                                scrollToSection(currentIndex);
                            }, 500); // Match the fade-out delay
                        }
                    });
                }
            };

            const hideSection = (index) => {
                if (index >= 0 && index < sections.length) {
                    sections[index].style.display = "none"; // Hide section
                }
            };

            showSection(currentIndex);
            scrollToSection(currentIndex);
        }

        function scrollToSection(index) {
            const section = document.querySelectorAll(".section")[index];
            section.scrollIntoView({ behavior: 'smooth' });
        }

        function speakText(text, callback) {
            const selectedLang = document.getElementById("language").value;
            let voice = "UK English Male";

            switch (selectedLang) {
                case "Arabic":
                    voice = "Arabic Male";
                    break;
                case "French":
                    voice = "French Female";
                    break;
                case "Spanish":
                    voice = "Spanish Female";
                    break;
                case "German":
                    voice = "German Male";
                    break;
                case "English":
                default:
                    voice = "UK English Male";
                    break;
            }

            responsiveVoice.speak(text, voice, {
                onend: callback
            });
        }

        function stopSpeaking() {
            responsiveVoice.cancel();
        }
    </script>
</body>

</html>
